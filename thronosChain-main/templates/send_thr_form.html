<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”¥ Thronos â€“ Send THR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #000;
      color: #00ff66;
      font-family: "Courier New", monospace;
    }
    a { color: #00ff66; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .nav {
      border-bottom: 1px solid #00ff66;
      padding: 8px 16px;
      margin-bottom: 24px;
    }
    .nav a {
      margin-right: 16px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
      border: 1px dashed #00ff66;
    }
    h1 {
      text-align: center;
      margin-bottom: 24px;
    }
    label {
      display: block;
      margin-top: 12px;
      margin-bottom: 4px;
    }
    input {
      width: 100%;
      padding: 6px 8px;
      background: #000;
      border: 1px solid #00ff66;
      color: #00ff66;
      font-family: inherit;
    }
    button {
      margin-top: 16px;
      padding: 8px 16px;
      background: #00ff66;
      color: #000;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background: #00cc55;
    }
    .row {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }
    .col {
      flex: 1 1 260px;
    }
    pre {
      background: #050505;
      border: 1px solid #00ff66;
      padding: 8px;
      max-height: 260px;
      overflow: auto;
      font-size: 12px;
    }
    .small-note {
      font-size: 11px;
      color: #cccccc;
    }
  </style>
</head>
<body>

<div class="nav">
  <a href="{{ url_for('home') }}">ğŸ  Home</a>
  <a href="{{ url_for('pledge_form') }}">ğŸ”¥ Pledge</a>
  <a href="{{ url_for('viewer') }}">ğŸ§± Viewer</a>
  <a href="{{ url_for('wallet_page') }}">ğŸ’° Wallet</a>
  <a href="{{ url_for('send_page') }}">ğŸ“¤ Send</a>
</div>

<div class="container">
  <h1>ğŸ“¤ Send THR</h1>

  <div class="row">
    <div class="col">
      <label for="from_thr">From THR Address</label>
      <input id="from_thr" placeholder="Ï€.Ï‡. THR1764..." />

      <label for="to_thr">To THR Address</label>
      <input id="to_thr" placeholder="Recipient THR address" />

      <label for="amount">Amount (THR)</label>
      <input id="amount" type="number" step="0.000001" min="0" value="0.1" />

      <label for="auth_secret">
        Send Secret (auth_secret)
      </label>
      <input id="auth_secret"
             placeholder="ÎœÏ…ÏƒÏ„Î¹ÎºÏŒ Ï€Î¿Ï… Ï€Î®ÏÎµÏ‚ Î¼Îµ Ï„Î¿ Pledge (send_secret)" />

      <div class="small-note">
        * Fee: {{ "%.4f"|format(0.0015) }} THR ÎºÎ±Î¯Î³ÎµÏ„Î±Î¹ ÏƒÎµ ÎºÎ¬Î¸Îµ Î±Ï€Î¿ÏƒÏ„Î¿Î»Î®.
      </div>

      <button onclick="doSend()">Send THR</button>
      <button onclick="loadBalance()">Load Balance</button>
    </div>

    <div class="col">
      <label>Balance & History (JSON)</label>
      <pre id="walletBox">{}</pre>

      <label>Send Result</label>
      <pre id="sendResult">{}</pre>
    </div>
  </div>
</div>

<script>
async function loadBalance() {
  const thr = document.getElementById('from_thr').value.trim();
  if (!thr) {
    alert('Î’Î¬Î»Îµ THR address Ï€ÏÏÏ„Î±');
    return;
  }
  try {
    const res = await fetch(`/wallet_data/${encodeURIComponent(thr)}`);
    const data = await res.json();
    document.getElementById('walletBox').textContent =
      JSON.stringify(data, null, 2);
  } catch (e) {
    document.getElementById('walletBox').textContent =
      'Error loading wallet: ' + e;
  }
}

async function doSend() {
  const from_thr    = document.getElementById('from_thr').value.trim();
  const to_thr      = document.getElementById('to_thr').value.trim();
  const amount      = document.getElementById('amount').value;
  const auth_secret = document.getElementById('auth_secret').value.trim();

  if (!from_thr || !to_thr) {
    alert('Î£Ï…Î¼Ï€Î»Î®ÏÏ‰ÏƒÎµ FROM ÎºÎ±Î¹ TO THR address');
    return;
  }
  if (!auth_secret) {
    alert('Î§ÏÎµÎ¹Î¬Î¶ÎµÏ„Î±Î¹ Ï„Î¿ send_secret Ï€Î¿Ï… Ï€Î®ÏÎµÏ‚ Î¼Îµ Ï„Î¿ Pledge');
    return;
  }

  try {
    const res = await fetch('/send_thr', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ from_thr, to_thr, amount, auth_secret })
    });
    const data = await res.json();
    document.getElementById('sendResult').textContent =
      JSON.stringify(data, null, 2);

    // Refresh balance Î¼ÎµÏ„Î¬ Ï„Î¿ send
    loadBalance();
  } catch (e) {
    document.getElementById('sendResult').textContent =
      'Error sending: ' + e;
  }
}
</script>

</body>
</html>
