<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”¥ Thronos Pledge to the Flame</title>

  <style>
    body { background:#000; color:#0f0; font-family:monospace; text-align:center; }
    nav { background:#111; padding:10px; }
    nav a { color:#0f0; margin:0 10px; text-decoration:none; }

    form { width:80%; max-width:650px; margin:20px auto; text-align:left; }
    input,textarea{
      width:100%; padding:8px; margin-top:5px;
      background:#111; border:1px solid #0f0; color:#0f0;
      font-family:monospace;
    }
    label{ font-weight:bold; margin-top:15px; display:block; }
    .info{ font-size:13px; color:#0f0; opacity:0.8; }

    #result{ margin-top:25px; border:1px solid #0f0;
      width:80%; max-width:650px; padding:15px; text-align:left; }
    #result.error{ border-color:red; color:red; }
    #result.success{ border-color:#0f0; }
    .pdf-link{ color:#0f0; text-decoration:underline; }
  </style>
</head>

<body>

<nav>
  <a href="/">ğŸ  Home</a>
  <a href="/pledge">ğŸ”¥ Pledge</a>
  <a href="/viewer">ğŸ“¦ Viewer</a>
  <a href="/wallet">ğŸ’¼ Wallet</a>
  <a href="/send">ğŸ’¸ Send</a>
</nav>

<h1>ğŸ”¥ Pledge to the Flame</h1>

<form id="pledgeForm">

  <label>BTC Address (KYC):</label>
  <input id="btc_address" placeholder="e.g. 1FQov4P8yz..." required>

  <label>Your Pledge:</label>
  <textarea id="pledge_text" rows="4">I hereby pledge allegiance to the Thronos Chain.</textarea>

  <label>Secret Passphrase (optional):</label>
  <input id="user_passphrase" placeholder="ÎœÏŒÎ½Î¿ ÎµÏƒÏ Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Ï„Î· Î³Î½Ï‰ÏÎ¯Î¶ÎµÎ¹Ï‚. / Only you must know this.">
  <div class="info">
    â€¢ If you add a passphrase, THR sending **requires both**: (PDF-stego seed + this phrase).<br>
    â€¢ If you lose BOTH â†’ no recovery possible (like a real blockchain).
  </div>

  <br><br>

  <div style="border:1px dashed #0f0; padding:15px; text-align:center;">
    <p>Send a minimum BTC fee to:</p>
    <p><b>1QFeDPwEF8yEgPEfP79hpc8pHytXMz9oEQ</b></p>
    <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=bitcoin:1QFeDPwEF8yEgPEfP79hpc8pHytXMz9oEQ"
         id="qr" title="Click to copy address" style="cursor:pointer;">
    <p style="font-size:12px">(Click QR to copy BTC address)</p>
  </div>

  <button type="submit">Submit Pledge</button>
</form>

<div id="result"></div>

<script>
document.getElementById("qr").onclick = () => {
  navigator.clipboard.writeText("1QFeDPwEF8yEgPEfP79hpc8pHytXMz9oEQ");
  alert("BTC address copied!");
};

document.getElementById("pledgeForm").onsubmit = async (e) => {
  e.preventDefault();
  const result = document.getElementById("result");
  result.className = "";
  result.textContent = "â³ Processing...";

  const payload = {
    btc_address: document.getElementById("btc_address").value.trim(),
    pledge_text: document.getElementById("pledge_text").value.trim(),
    user_passphrase: document.getElementById("user_passphrase").value.trim(),
  };

  try {
    const r = await fetch("/pledge_submit", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });
    const data = await r.json();
    if (!r.ok) throw new Error(data.error || data.message || "Unknown error");

    result.classList.add("success");
    result.innerHTML = `
      <b>ğŸ”¥ Pledge Accepted!</b><br><br>
      THR Address: <code>${data.thr_address}</code><br>
      Pledge Hash: <code>${data.pledge_hash}</code><br><br>
      ğŸ“„ <a class="pdf-link" href="/contracts/${data.pdf_filename}" target="_blank">Download Contract PDF</a><br><br>
      ğŸ’¼ <a href="/wallet/${data.thr_address}">Go to Wallet</a>
    `;
  } catch (err) {
    result.classList.add("error");
    result.innerHTML = `<b>âŒ Error:</b> ${err.message}`;
  }
};
</script>

</body>
</html>
